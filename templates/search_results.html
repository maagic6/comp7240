{% extends 'base.html' %}

{% block title %}Select songs{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Search results</h2>
        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Â« New Search</a>
    </div>
    <p class="lead">Showing results for: <strong>"{{ query }}"</strong></p>

    {% if error %}
        <div class="alert alert-warning" role="alert">
          {{ error }}
        </div>
    {% endif %}

    {% if results %}
        <form action="{{ url_for('recommend') }}" method="post">
            {% for term, songs in results.items() %}
                {% set outer_index = loop.index %}
                <div class="result-group mb-4">
                    <h3><small class="text-muted">For:</small> '{{ term }}'</h3>
                    {% if songs %}
                        <ul class="list-group">
                            {% for song in songs %}
                            <li class="list-group-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="selected_songs" value="{{ song.song_id }}" id="song_{{ outer_index }}_{{ loop.index }}">
                                    <label class="form-check-label" for="song_{{ outer_index }}_{{ loop.index }}">
                                        {{ song.title }} - <span class="text-muted">{{ song.artist_name }}</span>
                                    </label>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted fst-italic">No matches found for this term.</p>
                    {% endif %}
                </div>
            {% endfor %}
            <button type="submit" class="btn btn-success">Get recommendations</button>
        </form>
    {% elif not error %}
         <div class="alert alert-info" role="alert">
           No songs found matching your query.
         </div>
    {% endif %}

{% endblock %}